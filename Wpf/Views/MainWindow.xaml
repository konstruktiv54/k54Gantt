<!-- GanttChart.WPF/Views/MainWindow.xaml -->
<Window x:Class="k54Gantt.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:Wpf.Controls"
        xmlns:viewModels="clr-namespace:Wpf.ViewModels"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="700" 
        Width="1200"
        MinHeight="500"
        MinWidth="800"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BackgroundBrush}"
        d:DataContext="{d:DesignInstance Type=viewModels:MainViewModel, IsDesignTimeCreatable=False}">

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- ГОРЯЧИЕ КЛАВИШИ                                                 -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <Window.InputBindings>
        <KeyBinding Key="N" Modifiers="Control" Command="{Binding NewProjectCommand}"/>
        <KeyBinding Key="O" Modifiers="Control" Command="{Binding OpenProjectCommand}"/>
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveProjectCommand}"/>
        <KeyBinding Key="S" Modifiers="Control+Shift" Command="{Binding SaveProjectAsCommand}"/>
        <KeyBinding Key="OemPlus" Modifiers="Control" Command="{Binding ZoomInCommand}"/>
        <KeyBinding Key="OemMinus" Modifiers="Control" Command="{Binding ZoomOutCommand}"/>
        <KeyBinding Key="D0" Modifiers="Control" Command="{Binding ZoomResetCommand}"/>
    </Window.InputBindings>

    <!-- ═══════════════════════════════════════════════════════════════ -->
    <!-- ОСНОВНОЙ LAYOUT                                                 -->
    <!-- ═══════════════════════════════════════════════════════════════ -->
    <DockPanel LastChildFill="True">

        <!-- ─────────────────────────────────────────────────────────── -->
        <!-- MENU                                                        -->
        <!-- ─────────────────────────────────────────────────────────── -->
        <Menu DockPanel.Dock="Top" Style="{StaticResource MainMenuStyle}">
            
            <!-- File -->
            <MenuItem Header="_Файл">
                <MenuItem Header="Создать _демо-проект" 
                          Command="{Binding CreateDemoProjectCommand}"/>
                <MenuItem Header="_Новый" 
                          Command="{Binding NewProjectCommand}"
                          InputGestureText="Ctrl+N"/>
                <MenuItem Header="_Открыть..." 
                          Command="{Binding OpenProjectCommand}"
                          InputGestureText="Ctrl+O"/>
                <Separator/>
                <MenuItem Header="_Сохранить" 
                          Command="{Binding SaveProjectCommand}"
                          InputGestureText="Ctrl+S"/>
                <MenuItem Header="Сохранить _как..." 
                          Command="{Binding SaveProjectAsCommand}"
                          InputGestureText="Ctrl+Shift+S"/>
                <Separator/>
                <MenuItem Header="_Выход" 
                          Command="{Binding ExitApplicationCommand}"
                          InputGestureText="Alt+F4"/>
            </MenuItem>

            <!-- View -->
            <MenuItem Header="_Вид">
                <MenuItem Header="Увеличить" 
                          Command="{Binding ZoomInCommand}"
                          InputGestureText="Ctrl++"/>
                <MenuItem Header="Уменьшить" 
                          Command="{Binding ZoomOutCommand}"
                          InputGestureText="Ctrl+-"/>
                <MenuItem Header="Сбросить масштаб" 
                          Command="{Binding ZoomResetCommand}"
                          InputGestureText="Ctrl+0"/>
                <Separator/>
                <MenuItem Header="Показать связи" IsCheckable="True" IsChecked="True"/>
                <MenuItem Header="Показать резерв" IsCheckable="True" IsChecked="True"/>
            </MenuItem>

            <!-- Resources -->
            <MenuItem Header="_Ресурсы">
                <MenuItem Header="Управление ресурсами..." 
                          Command="{Binding ManageResourcesCommand}"/>
            </MenuItem>

            <!-- Help -->
            <MenuItem Header="_Справка">
                <MenuItem Header="О программе" 
                          Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- ─────────────────────────────────────────────────────────── -->
        <!-- STATUSBAR                                                   -->
        <!-- ─────────────────────────────────────────────────────────── -->
        <StatusBar DockPanel.Dock="Bottom" Style="{StaticResource MainStatusBarStyle}">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}" Style="{StaticResource StatusBarTextStyle}"/>
            </StatusBarItem>
            
            <Separator/>
            
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Задач: " Style="{StaticResource StatusBarTextStyle}"/>
                    <TextBlock Text="{Binding TaskCount}" Style="{StaticResource StatusBarTextStyle}" Margin="0"/>
                </StackPanel>
            </StatusBarItem>
            
            <Separator/>
            
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Масштаб: " Style="{StaticResource StatusBarTextStyle}"/>
                    <TextBlock Text="{Binding ZoomLevel, StringFormat={}{0}%}" 
                               Style="{StaticResource StatusBarTextStyle}" 
                               Margin="0"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>

        <!-- ─────────────────────────────────────────────────────────── -->
        <!-- MAIN CONTENT: Sidebar | Splitter | Chart                    -->
        <!-- ─────────────────────────────────────────────────────────── -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" MinWidth="200" MaxWidth="500"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*" MinWidth="400"/>
            </Grid.ColumnDefinitions>

            <!-- SIDEBAR: TreeView + DataGrid -->
            <Grid Grid.Column="0" Background="{StaticResource SidebarBackgroundBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- TreeView (иерархия задач) -->
                <DockPanel Grid.Row="0">
                    <TextBlock DockPanel.Dock="Top" 
                               Text="Структура проекта" 
                               FontWeight="SemiBold"
                               Margin="8,8,8,4"/>
                    <TreeView Style="{StaticResource TaskTreeViewStyle}"
                              Margin="4">
                        <!-- TODO: ItemsSource binding -->
                        <TreeViewItem Header="Проект (placeholder)" IsExpanded="True">
                            <TreeViewItem Header="Фаза 1"/>
                            <TreeViewItem Header="Фаза 2"/>
                        </TreeViewItem>
                    </TreeView>
                </DockPanel>

                <!-- Горизонтальный splitter -->
                <GridSplitter Grid.Row="1" 
                              Height="5" 
                              HorizontalAlignment="Stretch"
                              Background="{StaticResource GridLineBrush}"
                              Cursor="SizeNS"/>

                <!-- DataGrid (таблица задач) -->
                <DockPanel Grid.Row="2">
                    <TextBlock DockPanel.Dock="Top" 
                               Text="Список задач" 
                               FontWeight="SemiBold"
                               Margin="8,8,8,4"/>
                    <DataGrid Style="{StaticResource TaskDataGridStyle}"
                              Margin="4">
                        <!-- TODO: ItemsSource binding -->
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Название" Width="*" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Начало" Width="70" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Дни" Width="50" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </Grid>

            <!-- SPLITTER -->
            <GridSplitter Grid.Column="1" Style="{StaticResource VerticalSplitterStyle}"/>

            <!-- CHART AREA -->
            <Border Grid.Column="2" 
                    Background="{StaticResource BackgroundBrush}"
                    BorderBrush="{StaticResource GridLineBrush}"
                    BorderThickness="1,0,0,0">
    
                <controls:GanttChartControl 
                    x:Name="GanttChart"
                    ProjectManager="{Binding ProjectManager}"
                    ZoomLevel="{Binding ZoomLevel}"
                    SelectedTask="{Binding SelectedTask, Mode=TwoWay}"/>
            </Border>
        </Grid>
    </DockPanel>
</Window>